<!doctype html>
<html>
  <head>
    <title>test</title>
    <style type="text/css">
      * {
        margin: 1px;
      }
      canvas {
      }
    </style>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.23/p5.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/addons/p5.dom.js"></script>
  </head>
  <body>
      <script type="text/javascript">
        var p;
        var eyeSweep = 20;
        var seconds;
        
        function setup() {
          createCanvas(500, 500);
          background(200);
          angleMode(DEGREES);
          restart();
        }
        
        function restart() {
          initPlayers();
          seconds = 0;
        }
        
        function initPlayers() {
          p = {
            x: 20,
            y: height/2,
            angle: 0
          };
          
          light = {
            x: width - 20,
            y: height/2,
            angle: 180,
            go: false,
            d: 1,
            sweepWidth: 30 //actually half the sweep width
          }
        }
        
        function draw() {
          background(200);
          drawLight();
          drawPlayer();
          if (light.angle < 90-light.sweepWidth || light.angle > 270+light.sweepWidth) {
            var dir = light.angle < 90 ? 1 : -1;
            light.d = random(0,2)*dir;
          }
          //text("d"+light.d,width/2, height/2);
          displayTime();
          seconds += 1/60;
        }
        
        function displayTime() {
          text("Time elapsed: " + seconds.toFixed(3), width/2, 30);
        }
        
        function drawLight() {
          fill(200, 0, 0);
          ellipse(light.x, light.y, 20, 20);
          if (!light.go) {
            drawLightSweep();
            moveLight();
          }
        }
        
        function drawLightSweep() {
          var start = light.angle-light.sweepWidth;
          var stop = light.angle+light.sweepWidth;
          arc(light.x, light.y, width*2.5, width*2.5, start, stop); 
        }
        
        function test_showSlope() {
          stroke("yellow");
          line(light.x, light.y, light.x + width*cos(light.angle), light.y + width*sin(light.angle));
          var slope = tan(light.angle);
          text("slope: "+ slope, width/2, height/2);
        }
        
        function moveLight() {
          light.angle += light.d;
          if (keyIsPressed && sweepContains(p.x, p.y)) {
            stroke("black");
            fill("black");
            text("LOSE", width/2, height/3);
            // end the game
          }
        }
        
        function sweepContains(x, y) {
          // jank trix
          var slope_left = tan(light.angle + light.sweepWidth);
          var slope_right = tan(light.angle - light.sweepWidth);
          var slope_p = (light.y - p.y)/(light.x - p.x);
          if (slope_left > slope_p && slope_right < slope_p) {
            // dead
            text("dead", 0, height/2);
            return true;
          }
          return false;
          // will return the condition itself once i think about what i actually want to do
        }
        
        function drawSweep(x1, y1, angle, buffer, sweep) {
          line(x1, y1, x1 + sweep*cos(angle-buffer), y1 + sweep*sin(angle-buffer));
          line(x1, y1, x1 + sweep*cos(angle+buffer), y1 + sweep*sin(angle+buffer));
        }
        
        function drawPlayer() {
          stroke(0);
          noFill();
          ellipse(p.x, p.y, 20, 20);
          drawSweep(p.x, p.y, p.angle, 20, eyeSweep);
        }
        
        function keyPressed() {
          // unintuitive controlz~~~~!!!~!~!~!
          if (keyCode === LEFT_ARROW) {
            p.angle -= 2;
          }
          if (keyCode === RIGHT_ARROW) {
            p.angle += 2;
          }
          if (keyCode === UP_ARROW) {
            // go forward in the direction u r facing
            p.x += cos(p.angle);
            p.y += sin(p.angle);
          }
          if (keyCode === DOWN_ARROW) {
            p.x -= cos(p.angle);
            p.y -= sin(p.angle);
          }
        }
      </script>
  </body>
</html>